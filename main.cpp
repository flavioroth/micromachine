

#include "lib/cpu.hpp"

int main() {

	unsigned char test_bin[] = {
	  0x40, 0x40, 0x14, 0x28, 0x03, 0xd0, 0x03, 0x23, 0x98, 0x46, 0x01, 0x30,
	  0x40, 0x47, 0x00, 0xf0, 0x02, 0xf8, 0x05, 0x30, 0x00, 0xe0, 0x0a, 0x30,
	  0x00, 0xdf
	};




	cpu c;

	c.mem().map(test_bin, 0, sizeof(test_bin));

	c.reset();

	size_t faults = 0;
	for(int i = 0; i < 20000; i++) {
		faults += c.step();
		if(faults >= 2) {
			fprintf(stderr, "Too many faults. Aborting\n");
			break;
		}
	}

	c.regs().print();

	return 0;
}